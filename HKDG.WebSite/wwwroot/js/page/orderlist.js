var test = {"Succeeded":true,"Message":null,"ReturnValue":{"TotalPage":5,"TotalRecord":49,"Data":[{"Id":"a7b3327e-a2cf-4f8d-ab09-ac83c1d21b5c","OrderNo":"818002086","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":274.0,"DiscountTotalAmount":247.6,"TotalQty":3,"PaymentMethod":"","PMCode":"Payme","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":0.01,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 16:20:04","CreateDateString":"2022-10-20 16:20:04","UpdateDateString":"2022-10-20 17:25:16","UpdateDate":"2022-10-20 17:25:16","MemberName":null},{"Id":"66c4692e-53e5-46fc-86e9-123a6ba34d03","OrderNo":"818002081","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":178.0,"DiscountTotalAmount":150.2,"TotalQty":2,"PaymentMethod":"Stripe","PMCode":"Stripe","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":0.01,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 16:14:23","CreateDateString":"2022-10-20 16:14:23","UpdateDateString":"2022-10-20 17:21:13","UpdateDate":"2022-10-20 17:21:13","MemberName":null},{"Id":"7e6dfc34-ffe7-4dca-bb03-a0ec8dfcfc87","OrderNo":"818002076","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":98.0,"DiscountTotalAmount":88.0,"TotalQty":1,"PaymentMethod":"","PMCode":"Payme","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":0.0,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 15:54:41","CreateDateString":"2022-10-20 15:54:41","UpdateDateString":"2022-10-20 17:24:16","UpdateDate":"2022-10-20 17:24:16","MemberName":null},{"Id":"aa13c6f5-c8e8-42d7-ab7f-4b8f8949db04","OrderNo":"818002071","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":98.0,"DiscountTotalAmount":88.0,"TotalQty":1,"PaymentMethod":"Stripe","PMCode":"Stripe","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":0.0,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 15:53:27","CreateDateString":"2022-10-20 15:53:27","UpdateDateString":"2022-10-20 17:23:15","UpdateDate":"2022-10-20 17:23:15","MemberName":null},{"Id":"f7436db0-4cbb-496d-bbdd-4af3fa6ddf6b","OrderNo":"818002066","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":274.0,"DiscountTotalAmount":247.6,"TotalQty":3,"PaymentMethod":"Stripe","PMCode":"Stripe","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":0.0,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 15:51:32","CreateDateString":"2022-10-20 15:51:32","UpdateDateString":"2022-10-20 17:22:15","UpdateDate":"2022-10-20 17:22:15","MemberName":null},{"Id":"8a483c3a-88cc-453f-a6a5-26ea6200f624","OrderNo":"818002061","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":98.0,"DiscountTotalAmount":88.0,"TotalQty":1,"PaymentMethod":"","PMCode":"AlipayHK","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":0.0,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 15:43:56","CreateDateString":"2022-10-20 15:43:56","UpdateDateString":"2022-10-20 17:21:13","UpdateDate":"2022-10-20 17:21:13","MemberName":null},{"Id":"8a1482ef-3434-4147-9150-39f1ca8f7b6a","OrderNo":"818002056","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":157.0,"DiscountTotalAmount":142.3,"TotalQty":2,"PaymentMethod":"","PMCode":"AlipayHK","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":6.0,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-20 15:39:17","CreateDateString":"2022-10-20 15:39:17","UpdateDateString":"2022-10-20 17:21:14","UpdateDate":"2022-10-20 17:21:14","MemberName":null},{"Id":"121d9d96-fd3f-4d63-a8fd-a3f556cc31b9","OrderNo":"818001981","Products":null,"Status":7,"StatusName":"已取消訂單","TotalAmount":59.0,"DiscountTotalAmount":59.0,"TotalQty":1,"PaymentMethod":"Stripe","PMCode":"Stripe","PMRate":0.0,"PaymentMethodId":"00000000-0000-0000-0000-000000000000","IsPay":false,"TotalWeight":1.0,"Currency":{"Id":358,"Code":"HKD","Name":"港幣","ExchangeRate":1.0,"IsDefaultCurrency":true},"CreateDate":"2022-10-19 15:03:16","CreateDateString":"2022-10-19 15:03:16","UpdateDateString":"2022-10-19 18:30:22","UpdateDate":"2022-10-19 18:30:22","MemberName":null}],"Page":1,"PageSize":10,"Offset":0,"SortName":"","SortOrder":""}};

createApp({
	components: {
		'nav-tab': NavTab,
		'star-rating': StarRating
	},
  	data() {
  		return {
  			// -1 => 全部, 0 => 待付款, 1 => 已確認付款, 2 => 處理中, 3 => 已發貨, 4 => 已完成, 5 => 已取消
  			status: {},
  			statusData: [{
  				name: jsMessage.All,
  				value: -1
  			},{
  				name: jsMessage.Unpaid,
  				value: 0
  			},{
  				name: jsMessage.Receiving,
  				value: 1 // api訂單狀態傳值1會返回包含 已確認付款、處理中、 已發貨 三種狀態的訂單數據
  			},{
  				name: jsMessage.Completed,
  				value: 4
  			},{
  				name: jsMessage.Cancelled,
  				value: 5
  			}],
  			rating: 3,
  			orders: [],
        // totalRecord: 0,  // 當前目訂單列表總數量
        // totalPage: 1, // 當前目訂單列表總頁數
  			pager: { // 分頁數據
          page: 1,
          pageSize: 10
        }
  		}
	},
	methods: {
		// 獲取訂單信息
		getOrders: function (value, dropload) {
      if (value)  this.pager.page = value;

      var _this = this;
      InstoreSdk.api.order.getPageOrder(this.pager.pageSize, this.pager.page, this.status.value, "", function (result) {
        console.log(result,'獲取訂單信息')
          if (result.Succeeded) {
            _this.orders = _this.orders.concat(result.ReturnValue.Data);

            if (_this.pager.page === 1 && _this.orders.length) {
              _this.$nextTick(() => {
                loadPage($('.order-list'), result.ReturnValue.TotalPage, (val,me) => _this.getOrders(val, me));
              });
            }

            if (dropload) {
              _this.$nextTick(() => {
                dropload.resetload();
              });
            }
          } else {
            addtocartS(result.Message, '/imgs/warn-icon.png');
          }
      });
		},
		// 订单分类选择
		selectSort: function (val) {
			this.status = val;
      this.orders = [];
      this.pager.page = 1;
      this.getOrders();
		},
		// 評分及確認收貨
		signFor: function (item) {
			item.isRating = true;
		},
    // 查看訂單詳情
    orderDtl: function (order) {
      location.href = "/order/detail/" + order.Id;
    },
		// 价格格式化
    PriceFormat: function (value) {
      return PriceFormat(value);
    }
	},
	created() {
		this.status = this.statusData[0];
		this.getOrders();
	},
	mounted() {

	}
}).mount('#container')